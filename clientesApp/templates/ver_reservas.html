{% extends 'base/base.html' %}
{% block title %}Lista de Reservas{% endblock %}

{% block content %}
<div class="container mt-5">
    <!-- Título -->
    <h1 class="text-center mb-4">Lista de Reservas</h1>

    <!-- Formulario de búsqueda -->
    <form method="get" class="row g-3 mb-4">
        <div class="col-md-4">
            <input type="text" name="q" class="form-control" placeholder="Buscar..." value="{{ request.GET.q }}">
        </div>
        <div class="col-md-3">
            <select name="tipo_busqueda" class="form-select">
                <option value="codigo_reserva" {% if request.GET.tipo_busqueda == 'codigo_reserva' %}selected{% endif %}>Código de Reserva</option>
                <option value="patente" {% if request.GET.tipo_busqueda == 'patente' %}selected{% endif %}>Patente del Auto</option>
                <option value="rut" {% if request.GET.tipo_busqueda == 'rut' %}selected{% endif %}>RUT del Cliente</option>
            </select>
        </div>
        <div class="col-md-3">
            <select name="estado" class="form-select">
                <option value="" {% if request.GET.estado == '' %}selected{% endif %}>Todos los estados</option>
                <option value="activa" {% if request.GET.estado == 'activa' %}selected{% endif %}>Activa</option>
                <option value="completada" {% if request.GET.estado == 'completada' %}selected{% endif %}>Completada</option>
                <option value="cancelada" {% if request.GET.estado == 'cancelada' %}selected{% endif %}>Cancelada</option>
            </select>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Buscar</button>
        </div>
    </form>

    <!-- Tabla de reservas -->
    <table class="table table-striped table-bordered">
        <thead class="table-light">
            <tr>
                <th>Código</th>
                <th>Cliente</th>
                <th>Auto</th>
                <th>Estado</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            {% for reserva in reservas %}
            <tr>
                <td>{{ reserva.codigo_reserva }}</td>
                <td>{{ reserva.cliente.nombre_completo }}</td>
                <td>{{ reserva.auto.patente }}</td>
                <td>
                    {% if reserva.estado_reserva == 'activa' %}
                        <span class="badge bg-success">Activa</span>
                    {% elif reserva.estado_reserva == 'completada' %}
                        <span class="badge bg-primary">Completada</span>
                    {% elif reserva.estado_reserva == 'cancelada' %}
                        <span class="badge bg-danger">Cancelada</span>
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'cl_detalle_reserva' reserva.id %}" class="btn btn-info btn-sm">Detalles</a>
                    <a href="{% url 'cl_crear_reserva' %}" class="btn btn-success btn-sm">Crear</a>
                    <a href="{% url 'catalogo' %}" class="btn btn-secondary btn-sm">Catálogo</a>
                </td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="5" class="text-center text-danger">No se encontraron reservas.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
